# To use this config, during "make menuconfig", select "Enable
# low-level configuration options", select the STM32H723
# micro-controller, select a "128KiB bootloader", and select a "25Mhz
# crystal".

#[include Canbus_ebb36.cfg]

[include BTTEddy.cfg]

#[BTTEddy-auto_Z-offset.cfg]

[skew_correction]

[include mainsail.cfg]

[include macros.cfg]

[include shell_command.cfg]

[exclude_object]

[pause_resume]

# Enable arcs support
[gcode_arcs]
resolution: 0.1

#[force_move]
#enable_force_move: True
#   Set to true to enable FORCE_MOVE and SET_KINEMATIC_POSITION
#   extended G-Code commands. The default is false.


############################################
# Stepper Motors
############################################

;Stepper Side: Blue, Yellow, Black, Red
;Board Side: A1: Red, A2: Black, B2: Blue, B1: Yellow
[stepper_x]
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14
microsteps: 16
rotation_distance: 39.95
endstop_pin: !PG6
position_min: -3
position_endstop: -3
position_max: 255
homing_speed: 70.0

[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
microsteps: 16
rotation_distance: 32
endstop_pin: !PG9
position_min: -17
position_endstop: -16
position_max: 265
homing_speed: 60.0

[stepper_z] # Right Z Axis
step_pin: PE2
dir_pin: !PE3
enable_pin: !PD4
microsteps: 16
rotation_distance: 8
#endstop_pin: probe:z_virtual_endstop
endstop_pin: PG13
#position_endstop: 0.0
position_max: 250
position_min: -20 # Default = -3
homing_speed: 5

[stepper_z1] # Left Z Axis
step_pin: PE6
dir_pin: !PA14
enable_pin: !PE0
microsteps: 16
rotation_distance: 8
#endstop_pin: probe:z_virtual_endstop
endstop_pin: PG12

[extruder] ;Orbiter V2 Extruder
step_pin: EBB: PD0
dir_pin: EBB: PD1
enable_pin: !EBB: PD2
microsteps: 16
rotation_distance: 35.32           # Has to be calibrated by everyone
pressure_advance: 0.03              # Pressure Advance
gear_ratio: 7.5:1
full_steps_per_rotation: 200
nozzle_diameter: 0.600
filament_diameter: 1.750
heater_pin: EBB: PB13
sensor_pin: EBB: PA3
sensor_type: ATC Semitec 104GT-2
#control: pid
#pid_kp: 28.937
#pid_ki: 1.295
#pid_kd: 161.688
min_temp: 0
max_temp: 300
max_extrude_cross_section: 50.0
max_extrude_only_distance: 500
max_extrude_only_velocity: 120
min_extrude_temp: 180 ;Default = 180

########################################
# TMC Stepper Drivers UART configuration
########################################

[tmc2209 stepper_x]
uart_pin: PC4
diag_pin: PG6
run_current: 0.778
interpolate: True
stealthchop_threshold:0 # Default: 0 - Disabled
#uart_address: 3

[tmc2209 stepper_y]
uart_pin: PD11
diag_pin: PG9
run_current: 0.778
interpolate: True
stealthchop_threshold:0 # Default: 0 - Disabled
#uart_address: 2

[tmc2209 stepper_z]
uart_pin: PE1
run_current: 0.566
interpolate: True
stealthchop_threshold: 400 # Default: 400
#uart_address: 1

[tmc2209 stepper_z1]
uart_pin: PD3
run_current: 0.566
interpolate: True
stealthchop_threshold: 400 # Default: 400
#uart_address: 0

[tmc2209 extruder] # Orbiter V2 - LDO-36st17-1004ahg
uart_pin: EBB: PA15
interpolate: False # Current Klipper standard is to disable this
run_current: 0.85 # Set to your motor current
#hold_current: 0.100 # Should not be set
sense_resistor: 0.11 # Set to your Stepstick value
stealthchop_threshold: 0 # Default: 0 - Disabled
#driver_TBL: 0 # I'm not sure why these are in the default from the orbiter project but I have them commented out.
#driver_HEND: 6
#driver_HSTRT: 7
#driver_TOFF: 4
############################################
# FANS
############################################

[temperature_fan psu] # PSU Fan
pin: PD12
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF4 # PF4=Inside Therm - PF5=Outside Therm
target_temp: 40.0
shutdown_speed: 1.0
off_below: 1.0
min_speed: 0.0
max_speed: 1.0
min_temp: 10
max_temp: 60
pid_Kp: 20
pid_Ki: 0 # Dynamic = 0
pid_Kd: 0 # Dynamic = 0
control = pid


[fan] # Part Cooling Fan
pin: EBB: PA1
#max_power: 0.8 # Sets Maximum Fan Speed. Fx. 0.8 = Max 80% Speed
shutdown_speed: 0

[heater_fan hotend_fan] # Hotend Fan
pin: EBB: PA0
heater: extruder
heater_temp: 50.0
#fan_speed: 0.6  # Default 60% speed
#max_power: 1.0  # Allows full speed when needed
#kick_start_time: 0.5  # Helps fans start at low speeds
#off_below: 0.2  # Prevents the fan from running at very low, inefficient speeds
#cycle_time: 0.05  # Improves fan speed stability

[multi_pin MainboardFans]
pins: PA8, PE5

[temperature_fan Mainboard_Intake]
pin: multi_pin:MainboardFans
sensor_type: temperature_mcu
max_power: 1.0
shutdown_speed: 1.0
kick_start_time: 0.5
off_below: 0.6
max_temp: 100
min_temp: 5
target_temp: 45
max_speed: 1.0
min_speed: 0.0
control: pid
pid_Kp: 1
pid_Ki: 1
pid_Kd: 1

############################################
# Heatbed & Mesh
############################################

[heater_bed]
heater_pin: PA1
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF3
#control: pid
#pid_kp: 67.648
#pid_ki: 1.044
#pid_kd: 1095.893
min_temp: 0
max_temp: 110.5

;[bed_mesh]
;zero_reference_position: 122.5,122.5 ; middle of your bed

[safe_z_home]
home_xy_position: -3,-7
z_hop: 10

############################################
# sonstiges
############################################

[neopixel Print-Head_LED]
pin: EBB: PD3
chain_count: 8
initial_RED: 0.0
initial_GREEN: 0.0
initial_BLUE: 0.0
initial_WHITE: 0.0

#[filament_switch_sensor runout]

#[input_shaper]
#shaper_freq_x: 86.2
#shaper_type_x: mzv
#shaper_freq_y: 39.6
#shaper_type_y: mzv

[temperature_sensor Raspi]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

############################################
# MCU & Printer
############################################

[mcu] # Octopus Pro H723
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_170019000651313433343333-if00

[mcu EBB] # BTT Ebb36 CAN bus
canbus_uuid: 1793489d0809


[printer]
kinematics: cartesian
max_velocity: 150
max_accel: 1500            
max_accel_to_decel: 1500 
max_z_velocity: 5
max_z_accel: 100

[safe_z_home]
home_xy_position: -3,-7 # Choose an X,Y position that is in the center of your bed. For a 300x300 machine that will be 150, 150. Use the same principle to calculate your bed center.
z_hop: 10
z_hop_speed: 25
speed: 200


#[board_pins]
#aliases:
#    # EXP1 header
 #   EXP1_1=PE8, EXP1_2=PE7,
 #   EXP1_3=PE9, EXP1_4=PE10,
  #  EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
  #  EXP1_7=PE14, EXP1_8=PE15,
  #  EXP1_9=<GND>, EXP1_10=<5V>,

  #  # EXP2 header
  #  EXP2_1=PA6, EXP2_2=PA5,
  #  EXP2_3=PB1, EXP2_4=PA4,
   # EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
   # EXP2_7=PC15, EXP2_8=<RST>,
   # EXP2_9=<GND>, EXP2_10=PC5



############################################
# Input Shaper Config
############################################

[adxl345]
cs_pin: EBB: PB12
spi_software_sclk_pin: EBB: PB10
spi_software_mosi_pin: EBB: PB11
spi_software_miso_pin: EBB: PB2
axes_map: x,y,z

#[resonance_tester]
#accel_chip: adxl345
#probe_points:
#    122.5,125,20 

#[mcu rpi]
#serial: /tmp/klipper_host_mcu

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [stepper_z]
#*# position_endstop = 6.200
#*#
#*# [probe]
#*# z_offset = -0.461
#*#
#*# [skew_correction VyperSkew]
#*# xy_skew = -0.0019010472951699088
#*# xz_skew = 0.0
#*# yz_skew = 0.0
#*#
#*# [skew_correction CaliFlower]
#*# xy_skew = 0.0008999551908845329
#*# xz_skew = 0.0
#*# yz_skew = 0.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 41.114
#*# pid_ki = 17.130
#*# pid_kd = 24.670
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 67.843
#*# pid_ki = 1.005
#*# pid_kd = 1144.843
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3286780.971,0.090000:3286266.280,0.130000:3285651.062,
#*# 	0.170000:3285111.090,0.210000:3284546.398,0.250000:3283948.746,
#*# 	0.290000:3283412.996,0.330000:3282921.190,0.370000:3282395.408,
#*# 	0.410000:3281923.881,0.450000:3281359.082,0.490000:3280876.025,
#*# 	0.530000:3280289.665,0.570000:3279857.038,0.610000:3279342.898,
#*# 	0.650000:3278789.632,0.690000:3278204.853,0.730000:3277693.728,
#*# 	0.770000:3277079.401,0.810000:3276567.650,0.850000:3276005.800,
#*# 	0.890000:3275493.171,0.930000:3274934.640,0.970000:3274429.498,
#*# 	1.010000:3273885.248,1.050000:3273342.369,1.090000:3272761.272,
#*# 	1.130000:3272346.150,1.170000:3271780.239,1.210000:3271277.468,
#*# 	1.250000:3270748.744,1.290000:3270228.678,1.330000:3269687.204,
#*# 	1.370000:3269105.585,1.410000:3268537.059,1.450000:3267989.913,
#*# 	1.490000:3267444.636,1.530000:3266914.211,1.570000:3266351.290,
#*# 	1.610000:3265807.463,1.650000:3265233.424,1.690000:3264715.394,
#*# 	1.730000:3264194.866,1.770000:3263702.627,1.810000:3263162.683,
#*# 	1.850000:3262644.913,1.890000:3262092.179,1.930000:3261617.415,
#*# 	1.970000:3261059.654,2.010000:3260518.366,2.050000:3259898.161,
#*# 	2.090000:3259328.881,2.130000:3258747.574,2.170000:3258212.898,
#*# 	2.210000:3257629.588,2.250000:3257086.399,2.290000:3256547.524,
#*# 	2.330000:3256141.704,2.370000:3255622.011,2.410000:3255193.747,
#*# 	2.450000:3254763.337,2.490000:3254369.082,2.530000:3253940.085,
#*# 	2.570000:3253565.900,2.610000:3253017.524,2.650000:3252453.073,
#*# 	2.690000:3251845.576,2.730000:3251317.404,2.770000:3250742.791,
#*# 	2.810000:3250162.747,2.850000:3249620.707,2.890000:3249132.092,
#*# 	2.930000:3248576.660,2.970000:3248043.603,3.010000:3247540.358,
#*# 	3.050000:3247041.989,3.090000:3246583.823,3.130000:3246230.117,
#*# 	3.170000:3245906.841,3.210000:3245587.644,3.250000:3245286.135,
#*# 	3.290000:3244789.120,3.330000:3244317.696,3.370000:3243599.000,
#*# 	3.410000:3243271.034,3.450000:3242814.467,3.490000:3242536.381,
#*# 	3.530000:3242275.860,3.570000:3241940.185,3.610000:3241201.641,
#*# 	3.650000:3240913.777,3.690000:3240628.267,3.730000:3240374.561,
#*# 	3.770000:3240078.678,3.810000:3239381.507,3.850000:3239135.858,
#*# 	3.890000:3238877.509,3.930000:3238618.309,3.970000:3238392.048,
#*# 	4.010000:3237710.479,4.050000:3237128.666
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 44.028213
#*# drift_calibration =
#*# 	3318709.585262, -1252.096949, 11.312087
#*# 	3302119.662402, -953.894469, 9.060847
#*# 	3281908.612838, -513.419268, 5.411054
#*# 	3267489.030023, -308.857553, 4.134696
#*# 	3243611.193897, 392.042217, -2.989659
#*# 	3243790.177226, 58.516008, 0.947828
#*# 	3236196.358669, 154.180753, -0.242256
#*# 	3231107.559341, 183.751201, -0.775800
#*# 	3225943.090407, 274.895887, -2.087042
#*# drift_calibration_min_temp = 35.72168588453842
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -2.129134, -2.112146, -2.126359, -2.126537, -2.123927, -2.108986, -2.091817, -2.072520, -2.052764, -2.027385, -1.993384, -1.955265, -1.917604, -1.851240, -1.805035, -1.734319, -1.674926, -1.605710, -1.533723, -1.479306
#*# 	  -2.095468, -2.102045, -2.096442, -2.113994, -2.103977, -2.094071, -2.075131, -2.045536, -2.025923, -2.015123, -1.986458, -1.946263, -1.912142, -1.838229, -1.787129, -1.734671, -1.668918, -1.611844, -1.536817, -1.439344
#*# 	  -2.033143, -2.047049, -2.051686, -2.057020, -2.058596, -2.056967, -2.041292, -2.015043, -1.995050, -1.977785, -1.942867, -1.902357, -1.866035, -1.813083, -1.761544, -1.704875, -1.654700, -1.576864, -1.481928, -1.435220
#*# 	  -2.014888, -2.013159, -2.028884, -2.024502, -2.030210, -2.025501, -2.014768, -1.988215, -1.966377, -1.947994, -1.916329, -1.893245, -1.834026, -1.780820, -1.737276, -1.690864, -1.635378, -1.568681, -1.484738, -1.425204
#*# 	  -1.981106, -1.984647, -2.000927, -2.006180, -2.009535, -1.995886, -1.991031, -1.949791, -1.921661, -1.901726, -1.866823, -1.812442, -1.778007, -1.734799, -1.679978, -1.639914, -1.596809, -1.465464, -1.410729, -1.416911
#*# 	  -1.957905, -1.954890, -1.968317, -1.980955, -1.983519, -1.989173, -1.966908, -1.939296, -1.905290, -1.878148, -1.830892, -1.795221, -1.751069, -1.695170, -1.647701, -1.608468, -1.566507, -1.502762, -1.431691, -1.393412
#*# 	  -1.923655, -1.944027, -1.961055, -1.964399, -1.967744, -1.975608, -1.950282, -1.926276, -1.895560, -1.851174, -1.799776, -1.749054, -1.714859, -1.675387, -1.598598, -1.577654, -1.515743, -1.459754, -1.396217, -1.398428
#*# 	  -1.908281, -1.911576, -1.937613, -1.956171, -1.964545, -1.958722, -1.943742, -1.915830, -1.887146, -1.828900, -1.778313, -1.729879, -1.680650, -1.641311, -1.584469, -1.566230, -1.519671, -1.464687, -1.411830, -1.381721
#*# 	  -1.875821, -1.886063, -1.917008, -1.929678, -1.960266, -1.955697, -1.942895, -1.917527, -1.873799, -1.811451, -1.763239, -1.679747, -1.646808, -1.584005, -1.557242, -1.546620, -1.509070, -1.448929, -1.415183, -1.412283
#*# 	  -1.854027, -1.859300, -1.892988, -1.929981, -1.940044, -1.940977, -1.933928, -1.894649, -1.857945, -1.806634, -1.742900, -1.669215, -1.625036, -1.595135, -1.521801, -1.528932, -1.506532, -1.463795, -1.422848, -1.393782
#*# 	  -1.843629, -1.857443, -1.897102, -1.928314, -1.940809, -1.938590, -1.929082, -1.887303, -1.840785, -1.794834, -1.725412, -1.650660, -1.604089, -1.572483, -1.499271, -1.484579, -1.456998, -1.429728, -1.395232, -1.392233
#*# 	  -1.855096, -1.859933, -1.900178, -1.922119, -1.934856, -1.956013, -1.931557, -1.870344, -1.837542, -1.802698, -1.733339, -1.655815, -1.620496, -1.570383, -1.509720, -1.480668, -1.466255, -1.430190, -1.380356, -1.352078
#*# 	  -1.856169, -1.873418, -1.901139, -1.919314, -1.928485, -1.926357, -1.919405, -1.869150, -1.822804, -1.783560, -1.722906, -1.675937, -1.636749, -1.584980, -1.524878, -1.477034, -1.445347, -1.405326, -1.364398, -1.364397
#*# 	  -1.850257, -1.859927, -1.887709, -1.901409, -1.920893, -1.916747, -1.909218, -1.860443, -1.816259, -1.777272, -1.729704, -1.687077, -1.649728, -1.598850, -1.533431, -1.500738, -1.456777, -1.405642, -1.365521, -1.326305
#*# 	  -1.833444, -1.852049, -1.867867, -1.880830, -1.894974, -1.887402, -1.875986, -1.841438, -1.810345, -1.774918, -1.730590, -1.692019, -1.658619, -1.591248, -1.543477, -1.514479, -1.431599, -1.393547, -1.355237, -1.338543
#*# 	  -1.851921, -1.837374, -1.852924, -1.867753, -1.875882, -1.884502, -1.872093, -1.837535, -1.804169, -1.785308, -1.739404, -1.706494, -1.675449, -1.628815, -1.565635, -1.509280, -1.450831, -1.388232, -1.341096, -1.291117
#*# 	  -1.875141, -1.863291, -1.868444, -1.872844, -1.878785, -1.872089, -1.869114, -1.835255, -1.815039, -1.786497, -1.741368, -1.702549, -1.668743, -1.600698, -1.572914, -1.509698, -1.419053, -1.358824, -1.322274, -1.311114
#*# 	  -1.895301, -1.879769, -1.890365, -1.889978, -1.886569, -1.875590, -1.866525, -1.838562, -1.813122, -1.791914, -1.752375, -1.726302, -1.691254, -1.634526, -1.578007, -1.515099, -1.440358, -1.371844, -1.326140, -1.271080
#*# 	  -1.906624, -1.915901, -1.902259, -1.896472, -1.898489, -1.880971, -1.866577, -1.837702, -1.818791, -1.798775, -1.758321, -1.724829, -1.686348, -1.644707, -1.567819, -1.477919, -1.418522, -1.353954, -1.312825, -1.288019
#*# 	  -1.947906, -1.931138, -1.928093, -1.926075, -1.916036, -1.901976, -1.883087, -1.849424, -1.834775, -1.812501, -1.774032, -1.746328, -1.701332, -1.649727, -1.579615, -1.522499, -1.454599, -1.381713, -1.325286, -1.270899
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 234.83
#*# min_y = 20.0
#*# max_y = 244.96000000000004
