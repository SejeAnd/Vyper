# To use this config, during "make menuconfig", select "Enable
# low-level configuration options", select the STM32H723
# micro-controller, select a "128KiB bootloader", and select a "25Mhz
# crystal".

#[include Canbus_ebb36.cfg]

[include BTTEddy.cfg]

#[include ADXL345.cfg]

#[BTTEddy-auto_Z-offset.cfg]

[skew_correction]

[include mainsail.cfg]

[include macros.cfg]

[include shell_command.cfg]

[exclude_object]

[pause_resume]

# Enable arcs support
[gcode_arcs]
resolution: 0.1

#[force_move]
#enable_force_move: True
#   Set to true to enable FORCE_MOVE and SET_KINEMATIC_POSITION
#   extended G-Code commands. The default is false.


############################################
# Stepper Motors
############################################

;Stepper Side: Blue, Yellow, Black, Red
;Board Side: A1: Red, A2: Black, B2: Blue, B1: Yellow
[stepper_x]
step_pin: PF13
dir_pin: !PF12
enable_pin: !PF14
microsteps: 16
rotation_distance: 39.95
endstop_pin: !PG6
position_min: -3.1
position_endstop: -0.6
position_max: 263.5
homing_speed: 70.0

[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
microsteps: 16
rotation_distance: 32
endstop_pin: !PG9
position_min: -17
position_endstop: -16
position_max: 244
homing_speed: 60.0

[stepper_z] # Right Z Axis
step_pin: PE2
dir_pin: !PE3
enable_pin: !PD4
microsteps: 16
rotation_distance: 8
#endstop_pin: probe:z_virtual_endstop
endstop_pin: PG13
#position_endstop: 0.0
position_max: 250
position_min: -20 # Default = -3
homing_speed: 15

[stepper_z1] # Left Z Axis
step_pin: PE6
dir_pin: !PA14
enable_pin: !PE0
microsteps: 16
rotation_distance: 8
#endstop_pin: probe:z_virtual_endstop
endstop_pin: PG12

[extruder] ;Orbiter V2 Extruder
step_pin: EBB: PD0
dir_pin: EBB: PD1
enable_pin: !EBB: PD2
microsteps: 16
rotation_distance: 35.32           # Has to be calibrated by everyone
pressure_advance: 0.03              # Pressure Advance
gear_ratio: 7.5:1
full_steps_per_rotation: 200
nozzle_diameter: 0.600
filament_diameter: 1.750
heater_pin: EBB: PB13
sensor_pin: EBB: PA3
sensor_type: ATC Semitec 104GT-2
#control: pid
#pid_kp: 28.937
#pid_ki: 1.295
#pid_kd: 161.688
min_temp: 0
max_temp: 300
max_extrude_cross_section: 50.0
max_extrude_only_distance: 500
max_extrude_only_velocity: 120
min_extrude_temp: 180 ;Default = 180

########################################
# TMC Stepper Drivers UART configuration
########################################

[tmc2209 stepper_x]
uart_pin: PC4
diag_pin: PG6
run_current: 0.778
interpolate: True
stealthchop_threshold:0 # Default: 0 - Disabled
#uart_address: 3

[tmc2209 stepper_y]
uart_pin: PD11
diag_pin: PG9
run_current: 0.778
interpolate: True
stealthchop_threshold:0 # Default: 0 - Disabled
#uart_address: 2

[tmc2209 stepper_z]
uart_pin: PE1
run_current: 0.566
interpolate: True
stealthchop_threshold: 400 # Default: 400
#uart_address: 1

[tmc2209 stepper_z1]
uart_pin: PD3
run_current: 0.566
interpolate: True
stealthchop_threshold: 400 # Default: 400
#uart_address: 0

[tmc2209 extruder] # Orbiter V2 - LDO-36st17-1004ahg
uart_pin: EBB: PA15
interpolate: False # Current Klipper standard is to disable this
run_current: 0.85 # Set to your motor current
#hold_current: 0.100 # Should not be set
sense_resistor: 0.11 # Set to your Stepstick value
stealthchop_threshold: 0 # Default: 0 - Disabled
#driver_TBL: 0 # I'm not sure why these are in the default from the orbiter project but I have them commented out.
#driver_HEND: 6
#driver_HSTRT: 7
#driver_TOFF: 4
############################################
# FANS
############################################

[temperature_fan psu] # PSU Fan
pin: PD12
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF4 # PF4=Inside Therm - PF5=Outside Therm
target_temp: 40.0
shutdown_speed: 1.0
off_below: 1.0
min_speed: 0.0
max_speed: 1.0
min_temp: 10
max_temp: 60
pid_Kp: 20
pid_Ki: 0 # Dynamic = 0
pid_Kd: 0 # Dynamic = 0
control = pid


[fan] # Part Cooling Fan
pin: EBB: PA1
#max_power: 0.8 # Sets Maximum Fan Speed. Fx. 0.8 = Max 80% Speed
shutdown_speed: 0

[heater_fan hotend_fan] # Hotend Fan
pin: EBB: PA0
heater: extruder
heater_temp: 50.0
#fan_speed: 0.6  # Default 60% speed
#max_power: 1.0  # Allows full speed when needed
#kick_start_time: 0.5  # Helps fans start at low speeds
#off_below: 0.2  # Prevents the fan from running at very low, inefficient speeds
#cycle_time: 0.05  # Improves fan speed stability

[multi_pin MainboardFans]
pins: PA8, PE5

[temperature_fan Mainboard_Intake]
pin: multi_pin:MainboardFans
sensor_type: temperature_mcu
max_power: 1.0
shutdown_speed: 1.0
kick_start_time: 0.5
off_below: 0.6
max_temp: 100
min_temp: 5
target_temp: 45
max_speed: 1.0
min_speed: 0.0
control: pid
pid_Kp: 1
pid_Ki: 1
pid_Kd: 1

############################################
# Heatbed & Mesh
############################################

[heater_bed]
heater_pin: PA1
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF3
#control: pid
#pid_kp: 67.648
#pid_ki: 1.044
#pid_kd: 1095.893
min_temp: 0
max_temp: 110.5

;[bed_mesh]
;zero_reference_position: 122.5,122.5 ; middle of your bed

[safe_z_home]
home_xy_position: -3,-7
z_hop: 10

############################################
# sonstiges
############################################

[neopixel Print_Head_LED]
pin: EBB: PD3
#pin: PB10
color_order: GRB
chain_count: 8
initial_RED: 0.0
initial_GREEN: 0.0
initial_BLUE: 0.0
initial_WHITE: 0.0

[neopixel Top_LED]
pin: PB10
#pin: EBB: PD3
color_order: GRB
chain_count: 20
initial_RED: 0.0
initial_GREEN: 0.0
initial_BLUE: 0.0
initial_WHITE: 0.0

[input_shaper]
shaper_freq_x: 0
shaper_type_x: mzv
shaper_freq_y: 0
shaper_type_y: mzv

[temperature_sensor Raspi]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

############################################
# MCU & Printer
############################################

[mcu] # Octopus Pro H723
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_1E0014001351313234353230-if00

[mcu EBB] # BTT Ebb36 CAN bus
canbus_uuid: 1793489d0809


[printer]
kinematics: cartesian
max_velocity: 150
max_accel: 1500            
max_accel_to_decel: 1500 
max_z_velocity: 15
max_z_accel: 100

[safe_z_home]
home_xy_position: -3,-7 # Choose an X,Y position that is in the center of your bed. For a 300x300 machine that will be 150, 150. Use the same principle to calculate your bed center.
z_hop: 10
z_hop_speed: 25
speed: 200


#[board_pins]
#aliases:
#    # EXP1 header
 #   EXP1_1=PE8, EXP1_2=PE7,
 #   EXP1_3=PE9, EXP1_4=PE10,
  #  EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
  #  EXP1_7=PE14, EXP1_8=PE15,
  #  EXP1_9=<GND>, EXP1_10=<5V>,

  #  # EXP2 header
  #  EXP2_1=PA6, EXP2_2=PA5,
  #  EXP2_3=PB1, EXP2_4=PA4,
   # EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
   # EXP2_7=PC15, EXP2_8=<RST>,
   # EXP2_9=<GND>, EXP2_10=PC5



############################################
# Input Shaper Config
############################################

[adxl345]
cs_pin: EBB: PB12
spi_software_sclk_pin: EBB: PB10
spi_software_mosi_pin: EBB: PB11
spi_software_miso_pin: EBB: PB2
axes_map: x,y,z

#[resonance_tester]
#accel_chip: adxl345
#probe_points:
#    122.5,125,20 

#[mcu rpi]
#serial: /tmp/klipper_host_mcu

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [stepper_z]
#*# position_endstop = 7.470
#*#
#*# [probe]
#*# z_offset = -0.461
#*#
#*# [skew_correction VyperSkew]
#*# xy_skew = -0.0019010472951699088
#*# xz_skew = 0.0
#*# yz_skew = 0.0
#*#
#*# [skew_correction CaliFlower]
#*# xy_skew = 0.0008999551908845329
#*# xz_skew = 0.0
#*# yz_skew = 0.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 41.114
#*# pid_ki = 17.130
#*# pid_kd = 24.670
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 67.843
#*# pid_ki = 1.005
#*# pid_kd = 1144.843
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3238050.404,0.090000:3237741.879,0.130000:3237452.747,
#*# 	0.170000:3237149.980,0.210000:3236888.977,0.250000:3236570.433,
#*# 	0.290000:3236299.170,0.330000:3236031.180,0.370000:3235756.731,
#*# 	0.410000:3235477.039,0.450000:3235219.415,0.490000:3234940.114,
#*# 	0.530000:3234695.749,0.570000:3234432.287,0.610000:3234189.735,
#*# 	0.650000:3233941.416,0.690000:3233702.952,0.730000:3233449.783,
#*# 	0.770000:3233210.260,0.810000:3232969.744,0.850000:3232763.647,
#*# 	0.890000:3232499.480,0.930000:3232298.811,0.970000:3232050.668,
#*# 	1.010000:3231847.817,1.050000:3231631.340,1.090000:3231409.866,
#*# 	1.130000:3231199.599,1.170000:3230994.841,1.210000:3230797.806,
#*# 	1.250000:3230594.353,1.290000:3230388.947,1.330000:3230229.845,
#*# 	1.370000:3230009.047,1.410000:3229819.706,1.450000:3229607.359,
#*# 	1.490000:3229474.690,1.530000:3229253.079,1.570000:3229080.109,
#*# 	1.610000:3228919.823,1.650000:3228741.411,1.690000:3228554.707,
#*# 	1.730000:3228397.250,1.770000:3228212.537,1.810000:3228054.314,
#*# 	1.850000:3227899.491,1.890000:3227742.275,1.930000:3227582.598,
#*# 	1.970000:3227441.596,2.010000:3227265.469,2.050000:3227137.370,
#*# 	2.090000:3226967.992,2.130000:3226827.570,2.170000:3226695.523,
#*# 	2.210000:3226558.067,2.250000:3226395.970,2.290000:3226252.913,
#*# 	2.330000:3226133.539,2.370000:3225995.924,2.410000:3225845.075,
#*# 	2.450000:3225729.009,2.490000:3225598.728,2.530000:3225476.379,
#*# 	2.570000:3225345.599,2.610000:3225212.259,2.650000:3225090.882,
#*# 	2.690000:3224956.178,2.730000:3224836.752,2.770000:3224712.734,
#*# 	2.810000:3224604.324,2.850000:3224504.573,2.890000:3224386.684,
#*# 	2.930000:3224292.322,2.970000:3224147.637,3.010000:3224058.326,
#*# 	3.050000:3223930.016,3.090000:3223827.572,3.130000:3223728.578,
#*# 	3.170000:3223614.816,3.210000:3223518.382,3.250000:3223431.339,
#*# 	3.290000:3223319.265,3.330000:3223222.253,3.370000:3223129.103,
#*# 	3.410000:3223037.833,3.450000:3222947.202,3.490000:3222842.547,
#*# 	3.530000:3222755.442,3.570000:3222658.929,3.610000:3222563.614,
#*# 	3.650000:3222462.146,3.690000:3222393.610,3.730000:3222307.997,
#*# 	3.770000:3222236.218,3.810000:3222142.995,3.850000:3222081.666,
#*# 	3.890000:3221992.096,3.930000:3221898.781,3.970000:3221819.515,
#*# 	4.010000:3221772.913,4.050000:3221662.178
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 47.244086
#*# drift_calibration =
#*# 	3284048.783535, -683.052341, 4.066699
#*# 	3272432.955669, -507.947507, 2.530051
#*# 	3262875.306674, -373.047853, 1.414237
#*# 	3254457.847522, -258.994170, 0.598526
#*# 	3245969.892982, -109.758555, -0.615912
#*# 	3238832.841068, 11.885681, -1.584490
#*# 	3233741.162637, 74.414352, -1.987212
#*# 	3229791.634285, 114.821041, -2.223387
#*# 	3226577.253292, 146.407651, -2.407955
#*# drift_calibration_min_temp = 36.34736192861044
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.241516, 0.234154, 0.269789, 0.274942, 0.289882, 0.311095, 0.340696, 0.362846, 0.405289, 0.423868, 0.446735, 0.464977, 0.500350, 0.539899, 0.567130, 0.619447, 0.663674, 0.687562, 0.736223, 0.703204
#*# 	0.318862, 0.312912, 0.333247, 0.361348, 0.354918, 0.350821, 0.368301, 0.413463, 0.459670, 0.504589, 0.528300, 0.544364, 0.554656, 0.590683, 0.648154, 0.703610, 0.742284, 0.758597, 0.783771, 0.789686
#*# 	0.371413, 0.378030, 0.373667, 0.410702, 0.400713, 0.392623, 0.414388, 0.478969, 0.518522, 0.550758, 0.556126, 0.588395, 0.608393, 0.664935, 0.707058, 0.768305, 0.787632, 0.788088, 0.839069, 0.798024
#*# 	0.421945, 0.419286, 0.425901, 0.440428, 0.456255, 0.479326, 0.452854, 0.523554, 0.567244, 0.592204, 0.602071, 0.627695, 0.656060, 0.681343, 0.738199, 0.798950, 0.826863, 0.818757, 0.877198, 0.849179
#*# 	0.453947, 0.448415, 0.467899, 0.474184, 0.484392, 0.493849, 0.522902, 0.561299, 0.616709, 0.649605, 0.667246, 0.696022, 0.735139, 0.771650, 0.803969, 0.847248, 0.865298, 0.880103, 0.905842, 0.862622
#*# 	0.484412, 0.485596, 0.531180, 0.528469, 0.524338, 0.552945, 0.574294, 0.618724, 0.642618, 0.684969, 0.728311, 0.756872, 0.785119, 0.806861, 0.840400, 0.874576, 0.908397, 0.928098, 0.942188, 0.932658
#*# 	0.534597, 0.524450, 0.547161, 0.559360, 0.563723, 0.576380, 0.603316, 0.633484, 0.694845, 0.752286, 0.787459, 0.810335, 0.833792, 0.870891, 0.902184, 0.933599, 0.945081, 0.963308, 0.966128, 0.943021
#*# 	0.562576, 0.568076, 0.565732, 0.585911, 0.599057, 0.597970, 0.631562, 0.690263, 0.736330, 0.768899, 0.809458, 0.838974, 0.875655, 0.919645, 0.942857, 0.967498, 0.983004, 0.980804, 0.976492, 0.971942
#*# 	0.600531, 0.591122, 0.595134, 0.596572, 0.602974, 0.608770, 0.641677, 0.668880, 0.717622, 0.779397, 0.843929, 0.894280, 0.928264, 0.965265, 0.990762, 1.003390, 0.997365, 1.001188, 1.002508, 0.969287
#*# 	0.612039, 0.615624, 0.603810, 0.613196, 0.612718, 0.608995, 0.609403, 0.660329, 0.727135, 0.792751, 0.856190, 0.880801, 0.898508, 0.962946, 0.991035, 1.004158, 0.997147, 0.959792, 0.988930, 0.969234
#*# 	0.601863, 0.596678, 0.591971, 0.606090, 0.608302, 0.605164, 0.625422, 0.652480, 0.735369, 0.809674, 0.857582, 0.893642, 0.939397, 0.992451, 1.013314, 1.032174, 1.027968, 0.972502, 1.014384, 0.984009
#*# 	0.609242, 0.622768, 0.624324, 0.616895, 0.610739, 0.612293, 0.630135, 0.678962, 0.747471, 0.813187, 0.867244, 0.893949, 0.932205, 0.978393, 0.992415, 1.031498, 1.013942, 1.014378, 1.008855, 0.989616
#*# 	0.607447, 0.612625, 0.613101, 0.622086, 0.607329, 0.615893, 0.634212, 0.698471, 0.754492, 0.818141, 0.860168, 0.876846, 0.913047, 0.955887, 0.990471, 1.011724, 1.025750, 1.017372, 1.018338, 0.986682
#*# 	0.600340, 0.614563, 0.624377, 0.619232, 0.600801, 0.617658, 0.641610, 0.697567, 0.757703, 0.801413, 0.846749, 0.864894, 0.890035, 0.941702, 0.962452, 0.996255, 1.007185, 1.007185, 1.015389, 0.994877
#*# 	0.614417, 0.621130, 0.638386, 0.639467, 0.625452, 0.645497, 0.679487, 0.719202, 0.774099, 0.822003, 0.856081, 0.859275, 0.896997, 0.934027, 0.965204, 1.005875, 1.016882, 1.025656, 1.040744, 1.016614
#*# 	0.604273, 0.639917, 0.660458, 0.665271, 0.659220, 0.665736, 0.683551, 0.727277, 0.761263, 0.811454, 0.839850, 0.854803, 0.875613, 0.923417, 0.951502, 0.992918, 1.007764, 1.020849, 1.025496, 1.022124
#*# 	0.580730, 0.604909, 0.651036, 0.675957, 0.669902, 0.679446, 0.690313, 0.731053, 0.756322, 0.807927, 0.840183, 0.867287, 0.854197, 0.913252, 0.961351, 1.006170, 1.030810, 1.001441, 1.056891, 1.031908
#*# 	0.568943, 0.605893, 0.628412, 0.676792, 0.678771, 0.690527, 0.701146, 0.726496, 0.762664, 0.799420, 0.826518, 0.833663, 0.839484, 0.892216, 0.935856, 0.976103, 0.993568, 0.991847, 1.025861, 1.022086
#*# 	0.536397, 0.571444, 0.607732, 0.634503, 0.650503, 0.668333, 0.691030, 0.713408, 0.750120, 0.781033, 0.795876, 0.807397, 0.840907, 0.880236, 0.921336, 0.961724, 0.988561, 1.004319, 1.014346, 0.997158
#*# 	0.515184, 0.557811, 0.593169, 0.613364, 0.629558, 0.653946, 0.663620, 0.697624, 0.729184, 0.759911, 0.780620, 0.794207, 0.820886, 0.861677, 0.901679, 0.935138, 0.953368, 0.986972, 0.994895, 1.002819
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 234.83
#*# min_y = 20.0
#*# max_y = 244.96000000000004
