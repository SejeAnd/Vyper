# To use this config, during "make menuconfig", select "Enable
# low-level configuration options", select the STM32H723
# micro-controller, select a "128KiB bootloader", and select a "25Mhz
# crystal".

#[include Canbus_ebb36.cfg]

[include BTTEddy.cfg]

[skew_correction]

[include mainsail.cfg]

[include macros.cfg]

[include shell_command.cfg]

[exclude_object]

[pause_resume]

# Enable arcs support
[gcode_arcs]
resolution: 0.1

#[force_move]
#enable_force_move: True
#   Set to true to enable FORCE_MOVE and SET_KINEMATIC_POSITION
#   extended G-Code commands. The default is false.


############################################
# Stepper Motors
############################################

;Stepper Side: Blue, Yellow, Black, Red
;Board Side: A1: Red, A2: Black, B2: Blue, B1: Yellow
[stepper_x]
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14
microsteps: 16
rotation_distance: 39.95
endstop_pin: !PG6
position_min: -3
position_endstop: -3
position_max: 255
homing_speed: 70.0

[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
microsteps: 16
rotation_distance: 32
endstop_pin: !PG9
position_min: -17
position_endstop: -16
position_max: 265
homing_speed: 60.0

[stepper_z] # Left Z Axis
step_pin: PE2
dir_pin: !PE3
enable_pin: !PD4
microsteps: 16
rotation_distance: 8
endstop_pin: probe:z_virtual_endstop
#endstop_pin: PG12
#position_endstop: 0.0
position_max: 250
position_min: -5
homing_speed: 50.0

[stepper_z1] # Right Z Axis
step_pin: PE6
dir_pin: !PA14
enable_pin: !PE0
microsteps: 16
rotation_distance: 8
endstop_pin: probe:z_virtual_endstop
#endstop_pin: PG13

[extruder] ;Orbiter V2 Extruder
step_pin: EBB: PD0
dir_pin: EBB: PD1
enable_pin: !EBB: PD2
microsteps: 16
rotation_distance: 35.32           # Has to be calibrated by everyone
pressure_advance: 0.03              # Pressure Advance
gear_ratio: 7.5:1
full_steps_per_rotation: 200
nozzle_diameter: 0.600
filament_diameter: 1.750
heater_pin: EBB: PB13
sensor_pin: EBB: PA3
sensor_type: ATC Semitec 104GT-2
#control: pid
#pid_kp: 28.937
#pid_ki: 1.295
#pid_kd: 161.688
min_temp: 0
max_temp: 300
max_extrude_cross_section: 50.0
max_extrude_only_distance: 500
max_extrude_only_velocity: 120
min_extrude_temp: 180 ;Default = 180

########################################
# TMC Stepper Drivers UART configuration
########################################

[tmc2209 stepper_x]
uart_pin: PC4
diag_pin: PG6
run_current: 0.778
interpolate: True
stealthchop_threshold:0 # Default: 0 - Disabled
#uart_address: 3

[tmc2209 stepper_y]
uart_pin: PD11
diag_pin: PG9
run_current: 0.778
interpolate: True
stealthchop_threshold:0 # Default: 0 - Disabled
#uart_address: 2

[tmc2209 stepper_z]
uart_pin: PE1
run_current: 0.566
interpolate: True
stealthchop_threshold: 400 # Default: 400
#uart_address: 1

[tmc2209 stepper_z1]
uart_pin: PD3
run_current: 0.566
interpolate: True
stealthchop_threshold: 400 # Default: 400
#uart_address: 0

[tmc2209 extruder] # Orbiter V2 - LDO-36st17-1004ahg
uart_pin: EBB: PA15
interpolate: False # Current Klipper standard is to disable this
run_current: 0.85 # Set to your motor current
#hold_current: 0.100 # Should not be set
sense_resistor: 0.11 # Set to your Stepstick value
stealthchop_threshold: 0 # Default: 0 - Disabled
#driver_TBL: 0 # I'm not sure why these are in the default from the orbiter project but I have them commented out.
#driver_HEND: 6
#driver_HSTRT: 7
#driver_TOFF: 4
############################################
# FANS
############################################

[temperature_fan psu] # PSU Fan
pin: PD12
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF4 # PF4=Inside Therm - PF5=Outside Therm
target_temp: 40.0
shutdown_speed: 1.0
off_below: 1.0
min_speed: 0.0
max_speed: 1.0
min_temp: 10
max_temp: 60
pid_Kp: 20
pid_Ki: 0 # Dynamic = 0
pid_Kd: 0 # Dynamic = 0
control = pid


[fan] # Part Cooling Fan
pin: EBB: PA1
#max_power: 0.8 # Sets Maximum Fan Speed. Fx. 0.8 = Max 80% Speed
shutdown_speed: 0

[heater_fan hotend_fan] # Hotend Fan
pin: EBB: PA0
heater: extruder
heater_temp: 50.0
#fan_speed: 0.6  # Default 60% speed
#max_power: 1.0  # Allows full speed when needed
#kick_start_time: 0.5  # Helps fans start at low speeds
#off_below: 0.2  # Prevents the fan from running at very low, inefficient speeds
#cycle_time: 0.05  # Improves fan speed stability

[multi_pin MainboardFans]
pins: PA8, PE5

[temperature_fan Mainboard_Intake]
pin: multi_pin:MainboardFans
sensor_type: temperature_mcu
max_power: 1.0
shutdown_speed: 1.0
kick_start_time: 0.5
off_below: 0.6
max_temp: 100
min_temp: 5
target_temp: 45
max_speed: 1.0
min_speed: 0.0
control: pid
pid_Kp: 1
pid_Ki: 1
pid_Kd: 1

############################################
# Heatbed & Mesh
############################################

[heater_bed]
heater_pin: PA1
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF3
#control: pid
#pid_kp: 67.648
#pid_ki: 1.044
#pid_kd: 1095.893
min_temp: 0
max_temp: 110

;[bed_mesh]
;zero_reference_position: 122.5,122.5 ; middle of your bed

[safe_z_home]
home_xy_position: -3,-7
z_hop: 10

############################################
# sonstiges
############################################

[neopixel Print-Head_LED]
pin: EBB: PD3
chain_count: 8
initial_RED: 0.0
initial_GREEN: 0.0
initial_BLUE: 0.0
initial_WHITE: 0.0

#[filament_switch_sensor runout]

#[input_shaper]
#shaper_freq_x: 86.2
#shaper_type_x: mzv
#shaper_freq_y: 39.6
#shaper_type_y: mzv

[temperature_sensor Raspi]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

############################################
# MCU & Printer
############################################

[mcu] # Octopus Pro H723
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_170019000651313433343333-if00

[mcu EBB] # BTT Ebb36 CAN bus
canbus_uuid: 1793489d0809


[printer]
kinematics: cartesian
max_velocity: 150
max_accel: 1500            
max_accel_to_decel: 1500 
max_z_velocity: 5
max_z_accel: 100

#[board_pins]
#aliases:
#    # EXP1 header
 #   EXP1_1=PE8, EXP1_2=PE7,
 #   EXP1_3=PE9, EXP1_4=PE10,
  #  EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
  #  EXP1_7=PE14, EXP1_8=PE15,
  #  EXP1_9=<GND>, EXP1_10=<5V>,

  #  # EXP2 header
  #  EXP2_1=PA6, EXP2_2=PA5,
  #  EXP2_3=PB1, EXP2_4=PA4,
   # EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
   # EXP2_7=PC15, EXP2_8=<RST>,
   # EXP2_9=<GND>, EXP2_10=PC5



############################################
# Input Shaper Config
############################################

[adxl345]
cs_pin: EBB: PB12
spi_software_sclk_pin: EBB: PB10
spi_software_mosi_pin: EBB: PB11
spi_software_miso_pin: EBB: PB2
axes_map: x,y,z

#[resonance_tester]
#accel_chip: adxl345
#probe_points:
#    122.5,125,20 

#[mcu rpi]
#serial: /tmp/klipper_host_mcu

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [stepper_z]
#*# position_endstop = 1.360
#*#
#*# [probe]
#*# z_offset = -0.461
#*#
#*# [skew_correction VyperSkew]
#*# xy_skew = -0.0019010472951699088
#*# xz_skew = 0.0
#*# yz_skew = 0.0
#*#
#*# [skew_correction CaliFlower]
#*# xy_skew = 0.0008999551908845329
#*# xz_skew = 0.0
#*# yz_skew = 0.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 41.114
#*# pid_ki = 17.130
#*# pid_kd = 24.670
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 67.843
#*# pid_ki = 1.005
#*# pid_kd = 1144.843
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3282491.351,0.090000:3281244.477,0.130000:3280011.713,
#*# 	0.170000:3278794.457,0.210000:3277623.390,0.250000:3276424.517,
#*# 	0.290000:3275311.606,0.330000:3274117.757,0.370000:3273052.530,
#*# 	0.410000:3271984.508,0.450000:3270919.127,0.490000:3269917.515,
#*# 	0.530000:3268885.068,0.570000:3267917.486,0.610000:3266939.391,
#*# 	0.650000:3265993.549,0.690000:3265076.296,0.730000:3264234.032,
#*# 	0.770000:3263341.988,0.810000:3262497.479,0.850000:3261652.488,
#*# 	0.890000:3260832.286,0.930000:3260043.373,0.970000:3259222.303,
#*# 	1.010000:3258500.961,1.050000:3257722.031,1.090000:3257001.139,
#*# 	1.130000:3256251.442,1.170000:3255562.120,1.210000:3254869.150,
#*# 	1.250000:3254215.485,1.290000:3253536.882,1.330000:3252888.987,
#*# 	1.370000:3252268.569,1.410000:3251653.161,1.450000:3251058.792,
#*# 	1.490000:3250456.728,1.530000:3249864.809,1.570000:3249297.658,
#*# 	1.610000:3248721.542,1.650000:3248156.782,1.690000:3247660.897,
#*# 	1.730000:3247118.223,1.770000:3246587.884,1.810000:3246069.495,
#*# 	1.850000:3245585.868,1.890000:3245089.335,1.930000:3244609.619,
#*# 	1.970000:3244146.654,2.010000:3243674.938,2.050000:3243238.592,
#*# 	2.090000:3242789.131,2.130000:3242374.087,2.170000:3241925.649,
#*# 	2.210000:3241510.051,2.250000:3241099.023,2.290000:3240701.888,
#*# 	2.330000:3240292.438,2.370000:3239947.910,2.410000:3239566.263,
#*# 	2.450000:3239178.237,2.490000:3238830.303,2.530000:3238453.276,
#*# 	2.570000:3238097.118,2.610000:3237769.060,2.650000:3237415.464,
#*# 	2.690000:3237084.901,2.730000:3236787.671,2.770000:3236440.511,
#*# 	2.810000:3236138.057,2.850000:3235843.651,2.890000:3235529.044,
#*# 	2.930000:3235240.019,2.970000:3234933.127,3.010000:3234652.992,
#*# 	3.050000:3234371.576,3.090000:3234109.075,3.130000:3233797.158,
#*# 	3.170000:3233550.970,3.210000:3233290.349,3.250000:3233018.059,
#*# 	3.290000:3232763.523,3.330000:3232514.374,3.370000:3232280.840,
#*# 	3.410000:3232054.492,3.450000:3231819.420,3.490000:3231556.916,
#*# 	3.530000:3231350.627,3.570000:3231114.440,3.610000:3230882.008,
#*# 	3.650000:3230701.022,3.690000:3230452.974,3.730000:3230241.768,
#*# 	3.770000:3230057.606,3.810000:3229844.121,3.850000:3229641.365,
#*# 	3.890000:3229470.424,3.930000:3229255.565,3.970000:3229061.925,
#*# 	4.010000:3228866.238,4.050000:3228699.678
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 32.889262
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  2.462363, 2.455315, 2.432356, 2.410165, 2.388787, 2.376535, 2.372178, 2.342394, 2.331948, 2.305412, 2.304558, 2.290103, 2.276130, 2.263991, 2.264865, 2.250073, 2.237905, 2.237793, 2.218598, 2.172530
#*# 	  2.508752, 2.492212, 2.483813, 2.448081, 2.430100, 2.419956, 2.400467, 2.392374, 2.383708, 2.360748, 2.351674, 2.330606, 2.326577, 2.316653, 2.308239, 2.289731, 2.282743, 2.265355, 2.259844, 2.204864
#*# 	  2.555671, 2.548956, 2.531844, 2.501218, 2.478615, 2.458747, 2.451338, 2.443836, 2.436696, 2.412925, 2.407145, 2.393530, 2.377354, 2.368281, 2.351576, 2.339708, 2.321206, 2.307866, 2.295116, 2.235775
#*# 	  2.598319, 2.580855, 2.581283, 2.542232, 2.522223, 2.500091, 2.490220, 2.493685, 2.480867, 2.467154, 2.467876, 2.454500, 2.448896, 2.428851, 2.419153, 2.403228, 2.385706, 2.361928, 2.337021, 2.281037
#*# 	  2.627311, 2.641048, 2.621147, 2.583526, 2.558341, 2.548191, 2.535931, 2.538486, 2.527674, 2.512518, 2.522564, 2.515922, 2.498967, 2.490652, 2.475499, 2.461641, 2.433171, 2.413726, 2.394593, 2.329261
#*# 	  2.676842, 2.658060, 2.654760, 2.618233, 2.587318, 2.576795, 2.559809, 2.558342, 2.560156, 2.561012, 2.569291, 2.562828, 2.555325, 2.540017, 2.528182, 2.503816, 2.484506, 2.445732, 2.423069, 2.354392
#*# 	  2.700658, 2.694092, 2.676453, 2.633189, 2.606651, 2.593574, 2.574125, 2.583179, 2.580855, 2.591072, 2.604483, 2.609565, 2.602317, 2.588786, 2.574899, 2.538145, 2.510305, 2.470995, 2.436696, 2.379712
#*# 	  2.738320, 2.714292, 2.691003, 2.644346, 2.614235, 2.597572, 2.572656, 2.575166, 2.593162, 2.612068, 2.633116, 2.649386, 2.644681, 2.637897, 2.610648, 2.572923, 2.540782, 2.492558, 2.453687, 2.390769
#*# 	  2.739979, 2.723141, 2.694800, 2.646829, 2.612481, 2.593239, 2.568864, 2.578612, 2.586542, 2.614570, 2.655909, 2.673685, 2.684048, 2.670986, 2.634932, 2.593574, 2.542150, 2.498188, 2.459201, 2.398249
#*# 	  2.745263, 2.725107, 2.692353, 2.642531, 2.606651, 2.570332, 2.558342, 2.565845, 2.590247, 2.611731, 2.657985, 2.689265, 2.699559, 2.686496, 2.661616, 2.613152, 2.554979, 2.501565, 2.460828, 2.397352
#*# 	  2.750824, 2.726829, 2.690682, 2.648572, 2.598990, 2.568864, 2.557220, 2.571453, 2.586971, 2.615805, 2.659875, 2.690683, 2.696859, 2.683728, 2.653019, 2.604072, 2.552307, 2.499745, 2.455222, 2.396550
#*# 	  2.742622, 2.720254, 2.679610, 2.633450, 2.593162, 2.571801, 2.551877, 2.576020, 2.592490, 2.611396, 2.647904, 2.668473, 2.674074, 2.670276, 2.642863, 2.591407, 2.551614, 2.501565, 2.456036, 2.399665
#*# 	  2.725412, 2.702715, 2.669620, 2.626229, 2.584647, 2.569291, 2.557567, 2.570680, 2.588439, 2.609154, 2.628808, 2.639232, 2.644679, 2.634266, 2.613899, 2.579039, 2.527757, 2.488747, 2.450885, 2.399311
#*# 	  2.703104, 2.695120, 2.670345, 2.611731, 2.586542, 2.563602, 2.551531, 2.563255, 2.577837, 2.580587, 2.602317, 2.606315, 2.607733, 2.596823, 2.582751, 2.547849, 2.518819, 2.474806, 2.443383, 2.379712
#*# 	  2.674463, 2.682310, 2.649720, 2.612144, 2.576367, 2.562828, 2.542150, 2.558261, 2.560502, 2.568864, 2.573696, 2.568517, 2.562828, 2.555325, 2.549639, 2.516182, 2.489527, 2.462272, 2.428851, 2.372636
#*# 	  2.633857, 2.649720, 2.640788, 2.598655, 2.570680, 2.552307, 2.534400, 2.532186, 2.528440, 2.532952, 2.536696, 2.528865, 2.519584, 2.509877, 2.501997, 2.483465, 2.465888, 2.437509, 2.405540, 2.351217
#*# 	  2.598990, 2.613899, 2.602988, 2.588012, 2.553774, 2.535848, 2.507625, 2.509530, 2.498188, 2.490999, 2.501218, 2.489181, 2.472122, 2.463538, 2.448626, 2.432810, 2.422176, 2.398957, 2.375813, 2.317587
#*# 	  2.528782, 2.539594, 2.544363, 2.533633, 2.519159, 2.500438, 2.478529, 2.479656, 2.465980, 2.450523, 2.444197, 2.438685, 2.418706, 2.413279, 2.404738, 2.390061, 2.376174, 2.350397, 2.322958, 2.274423
#*# 	  2.480781, 2.497408, 2.492212, 2.491086, 2.477836, 2.467513, 2.445371, 2.435520, 2.423069, 2.403133, 2.403935, 2.392374, 2.373815, 2.368282, 2.358290, 2.347356, 2.332471, 2.313559, 2.286317, 2.237412
#*# 	  2.432719, 2.433985, 2.439858, 2.431183, 2.429560, 2.428496, 2.409008, 2.407945, 2.391571, 2.381253, 2.367822, 2.349631, 2.340119, 2.328443, 2.322026, 2.309944, 2.282262, 2.266121, 2.244672, 2.202568
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 234.83
#*# min_y = 20.0
#*# max_y = 244.96000000000004
