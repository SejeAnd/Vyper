# To use this config, during "make menuconfig", select "Enable
# low-level configuration options", select the STM32H723
# micro-controller, select a "128KiB bootloader", and select a "25Mhz
# crystal".

#[include Canbus_ebb36.cfg]

[include BTTEddy.cfg]

#[BTTEddy-auto_Z-offset.cfg]

[skew_correction]

[include mainsail.cfg]

[include macros.cfg]

[include shell_command.cfg]

[exclude_object]

[pause_resume]

# Enable arcs support
[gcode_arcs]
resolution: 0.1

#[force_move]
#enable_force_move: True
#   Set to true to enable FORCE_MOVE and SET_KINEMATIC_POSITION
#   extended G-Code commands. The default is false.


############################################
# Stepper Motors
############################################

;Stepper Side: Blue, Yellow, Black, Red
;Board Side: A1: Red, A2: Black, B2: Blue, B1: Yellow
[stepper_x]
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14
microsteps: 16
rotation_distance: 39.95
endstop_pin: !PG6
position_min: -3
position_endstop: -3
position_max: 255
homing_speed: 70.0

[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
microsteps: 16
rotation_distance: 32
endstop_pin: !PG9
position_min: -17
position_endstop: -16
position_max: 265
homing_speed: 60.0

[stepper_z] # Right Z Axis
step_pin: PE2
dir_pin: !PE3
enable_pin: !PD4
microsteps: 16
rotation_distance: 8
#endstop_pin: probe:z_virtual_endstop
endstop_pin: PG13
#position_endstop: 0.0
position_max: 250
position_min: -20 # Default = -3
homing_speed: 5

[stepper_z1] # Left Z Axis
step_pin: PE6
dir_pin: !PA14
enable_pin: !PE0
microsteps: 16
rotation_distance: 8
#endstop_pin: probe:z_virtual_endstop
endstop_pin: PG12

[extruder] ;Orbiter V2 Extruder
step_pin: EBB: PD0
dir_pin: EBB: PD1
enable_pin: !EBB: PD2
microsteps: 16
rotation_distance: 35.32           # Has to be calibrated by everyone
pressure_advance: 0.03              # Pressure Advance
gear_ratio: 7.5:1
full_steps_per_rotation: 200
nozzle_diameter: 0.600
filament_diameter: 1.750
heater_pin: EBB: PB13
sensor_pin: EBB: PA3
sensor_type: ATC Semitec 104GT-2
#control: pid
#pid_kp: 28.937
#pid_ki: 1.295
#pid_kd: 161.688
min_temp: 0
max_temp: 300
max_extrude_cross_section: 50.0
max_extrude_only_distance: 500
max_extrude_only_velocity: 120
min_extrude_temp: 180 ;Default = 180

########################################
# TMC Stepper Drivers UART configuration
########################################

[tmc2209 stepper_x]
uart_pin: PC4
diag_pin: PG6
run_current: 0.778
interpolate: True
stealthchop_threshold:0 # Default: 0 - Disabled
#uart_address: 3

[tmc2209 stepper_y]
uart_pin: PD11
diag_pin: PG9
run_current: 0.778
interpolate: True
stealthchop_threshold:0 # Default: 0 - Disabled
#uart_address: 2

[tmc2209 stepper_z]
uart_pin: PE1
run_current: 0.566
interpolate: True
stealthchop_threshold: 400 # Default: 400
#uart_address: 1

[tmc2209 stepper_z1]
uart_pin: PD3
run_current: 0.566
interpolate: True
stealthchop_threshold: 400 # Default: 400
#uart_address: 0

[tmc2209 extruder] # Orbiter V2 - LDO-36st17-1004ahg
uart_pin: EBB: PA15
interpolate: False # Current Klipper standard is to disable this
run_current: 0.85 # Set to your motor current
#hold_current: 0.100 # Should not be set
sense_resistor: 0.11 # Set to your Stepstick value
stealthchop_threshold: 0 # Default: 0 - Disabled
#driver_TBL: 0 # I'm not sure why these are in the default from the orbiter project but I have them commented out.
#driver_HEND: 6
#driver_HSTRT: 7
#driver_TOFF: 4
############################################
# FANS
############################################

[temperature_fan psu] # PSU Fan
pin: PD12
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF4 # PF4=Inside Therm - PF5=Outside Therm
target_temp: 40.0
shutdown_speed: 1.0
off_below: 1.0
min_speed: 0.0
max_speed: 1.0
min_temp: 10
max_temp: 60
pid_Kp: 20
pid_Ki: 0 # Dynamic = 0
pid_Kd: 0 # Dynamic = 0
control = pid


[fan] # Part Cooling Fan
pin: EBB: PA1
#max_power: 0.8 # Sets Maximum Fan Speed. Fx. 0.8 = Max 80% Speed
shutdown_speed: 0

[heater_fan hotend_fan] # Hotend Fan
pin: EBB: PA0
heater: extruder
heater_temp: 50.0
#fan_speed: 0.6  # Default 60% speed
#max_power: 1.0  # Allows full speed when needed
#kick_start_time: 0.5  # Helps fans start at low speeds
#off_below: 0.2  # Prevents the fan from running at very low, inefficient speeds
#cycle_time: 0.05  # Improves fan speed stability

[multi_pin MainboardFans]
pins: PA8, PE5

[temperature_fan Mainboard_Intake]
pin: multi_pin:MainboardFans
sensor_type: temperature_mcu
max_power: 1.0
shutdown_speed: 1.0
kick_start_time: 0.5
off_below: 0.6
max_temp: 100
min_temp: 5
target_temp: 45
max_speed: 1.0
min_speed: 0.0
control: pid
pid_Kp: 1
pid_Ki: 1
pid_Kd: 1

############################################
# Heatbed & Mesh
############################################

[heater_bed]
heater_pin: PA1
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PF3
#control: pid
#pid_kp: 67.648
#pid_ki: 1.044
#pid_kd: 1095.893
min_temp: 0
max_temp: 110.5

;[bed_mesh]
;zero_reference_position: 122.5,122.5 ; middle of your bed

[safe_z_home]
home_xy_position: -3,-7
z_hop: 10

############################################
# sonstiges
############################################

[neopixel Print-Head_LED]
pin: EBB: PD3
chain_count: 8
initial_RED: 0.0
initial_GREEN: 0.0
initial_BLUE: 0.0
initial_WHITE: 0.0

#[input_shaper]
#shaper_freq_x: 86.2
#shaper_type_x: mzv
#shaper_freq_y: 39.6
#shaper_type_y: mzv

[temperature_sensor Raspi]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

############################################
# MCU & Printer
############################################

[mcu] # Octopus Pro H723
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_170019000651313433343333-if00

[mcu EBB] # BTT Ebb36 CAN bus
canbus_uuid: 1793489d0809


[printer]
kinematics: cartesian
max_velocity: 150
max_accel: 1500            
max_accel_to_decel: 1500 
max_z_velocity: 5
max_z_accel: 100

[safe_z_home]
home_xy_position: -3,-7 # Choose an X,Y position that is in the center of your bed. For a 300x300 machine that will be 150, 150. Use the same principle to calculate your bed center.
z_hop: 10
z_hop_speed: 25
speed: 200


#[board_pins]
#aliases:
#    # EXP1 header
 #   EXP1_1=PE8, EXP1_2=PE7,
 #   EXP1_3=PE9, EXP1_4=PE10,
  #  EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
  #  EXP1_7=PE14, EXP1_8=PE15,
  #  EXP1_9=<GND>, EXP1_10=<5V>,

  #  # EXP2 header
  #  EXP2_1=PA6, EXP2_2=PA5,
  #  EXP2_3=PB1, EXP2_4=PA4,
   # EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
   # EXP2_7=PC15, EXP2_8=<RST>,
   # EXP2_9=<GND>, EXP2_10=PC5



############################################
# Input Shaper Config
############################################

[adxl345]
cs_pin: EBB: PB12
spi_software_sclk_pin: EBB: PB10
spi_software_mosi_pin: EBB: PB11
spi_software_miso_pin: EBB: PB2
axes_map: x,y,z

#[resonance_tester]
#accel_chip: adxl345
#probe_points:
#    122.5,125,20 

#[mcu rpi]
#serial: /tmp/klipper_host_mcu

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [stepper_z]
#*# position_endstop = 8.280
#*#
#*# [probe]
#*# z_offset = -0.461
#*#
#*# [skew_correction VyperSkew]
#*# xy_skew = -0.0019010472951699088
#*# xz_skew = 0.0
#*# yz_skew = 0.0
#*#
#*# [skew_correction CaliFlower]
#*# xy_skew = 0.0008999551908845329
#*# xz_skew = 0.0
#*# yz_skew = 0.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 41.114
#*# pid_ki = 17.130
#*# pid_kd = 24.670
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 67.843
#*# pid_ki = 1.005
#*# pid_kd = 1144.843
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:3297541.866,0.090000:3295948.135,0.130000:3294372.125,
#*# 	0.170000:3292889.487,0.210000:3291357.992,0.250000:3289883.444,
#*# 	0.290000:3288455.577,0.330000:3287074.338,0.370000:3285734.659,
#*# 	0.410000:3284353.457,0.450000:3283040.676,0.490000:3281805.124,
#*# 	0.530000:3280578.586,0.570000:3279313.007,0.610000:3278137.835,
#*# 	0.650000:3276985.357,0.690000:3275864.234,0.730000:3274707.228,
#*# 	0.770000:3273631.348,0.810000:3272581.439,0.850000:3271546.301,
#*# 	0.890000:3270478.948,0.930000:3269516.643,0.970000:3268534.364,
#*# 	1.010000:3267609.321,1.050000:3266620.165,1.090000:3265734.932,
#*# 	1.130000:3264831.246,1.170000:3263965.280,1.210000:3263100.706,
#*# 	1.250000:3262271.633,1.290000:3261446.720,1.330000:3260661.131,
#*# 	1.370000:3259871.249,1.410000:3259070.814,1.450000:3258336.638,
#*# 	1.490000:3257632.889,1.530000:3256881.520,1.570000:3256168.671,
#*# 	1.610000:3255493.451,1.650000:3254802.158,1.690000:3254136.195,
#*# 	1.730000:3253495.258,1.770000:3252865.158,1.810000:3252237.525,
#*# 	1.850000:3251608.841,1.890000:3251002.744,1.930000:3250420.208,
#*# 	1.970000:3249894.823,2.010000:3249304.129,2.050000:3248739.894,
#*# 	2.090000:3248217.570,2.130000:3247713.594,2.170000:3247173.036,
#*# 	2.210000:3246652.629,2.250000:3246161.991,2.290000:3245675.687,
#*# 	2.330000:3245191.323,2.370000:3244747.501,2.410000:3244264.349,
#*# 	2.450000:3243815.534,2.490000:3243369.449,2.530000:3242936.568,
#*# 	2.570000:3242487.055,2.610000:3242086.476,2.650000:3241678.593,
#*# 	2.690000:3241255.013,2.730000:3240869.481,2.770000:3240472.848,
#*# 	2.810000:3240086.876,2.850000:3239711.738,2.890000:3239372.746,
#*# 	2.930000:3239016.039,2.970000:3238647.130,3.010000:3238286.849,
#*# 	3.050000:3237977.261,3.090000:3237627.249,3.130000:3237291.282,
#*# 	3.170000:3236975.645,3.210000:3236651.970,3.250000:3236348.215,
#*# 	3.290000:3236036.483,3.330000:3235734.647,3.370000:3235436.208,
#*# 	3.410000:3235157.961,3.450000:3234868.739,3.490000:3234597.716,
#*# 	3.530000:3234332.217,3.570000:3234044.191,3.610000:3233766.236,
#*# 	3.650000:3233519.001,3.690000:3233277.299,3.730000:3233019.327,
#*# 	3.770000:3232742.608,3.810000:3232540.487,3.850000:3232284.814,
#*# 	3.890000:3232058.348,3.930000:3231816.854,3.970000:3231600.391,
#*# 	4.010000:3231350.831,4.050000:3231124.479
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 38.379042
#*# drift_calibration =
#*# 	3318709.585262, -1252.096949, 11.312087
#*# 	3302119.662402, -953.894469, 9.060847
#*# 	3281908.612838, -513.419268, 5.411054
#*# 	3267489.030023, -308.857553, 4.134696
#*# 	3243611.193897, 392.042217, -2.989659
#*# 	3243790.177226, 58.516008, 0.947828
#*# 	3236196.358669, 154.180753, -0.242256
#*# 	3231107.559341, 183.751201, -0.775800
#*# 	3225943.090407, 274.895887, -2.087042
#*# drift_calibration_min_temp = 35.72168588453842
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-3.093195, -3.078422, -3.052818, -3.045070, -3.029133, -3.006793, -2.984089, -2.935486, -2.921093, -2.901039, -2.868058, -2.830354, -2.797272, -2.737122, -2.691745, -2.638566, -2.586858, -2.525744, -2.473164, -2.451327
#*# 	-3.042276, -3.015928, -3.021569, -3.001454, -2.989431, -2.975168, -2.953702, -2.918460, -2.891706, -2.868507, -2.838793, -2.812673, -2.778188, -2.717033, -2.666397, -2.618319, -2.564470, -2.516685, -2.463307, -2.396405
#*# 	-2.955304, -2.957198, -2.956188, -2.964461, -2.937405, -2.920234, -2.897944, -2.873111, -2.851008, -2.817556, -2.780593, -2.747861, -2.724159, -2.668476, -2.630628, -2.581886, -2.540959, -2.471626, -2.413176, -2.371504
#*# 	-2.923211, -2.915198, -2.908635, -2.903750, -2.900296, -2.879316, -2.862162, -2.831957, -2.803250, -2.775668, -2.746220, -2.703704, -2.681335, -2.635834, -2.590295, -2.547265, -2.505438, -2.449565, -2.397862, -2.351455
#*# 	-2.884884, -2.879886, -2.870739, -2.877352, -2.860477, -2.852979, -2.830270, -2.794432, -2.763115, -2.720090, -2.683087, -2.643985, -2.611715, -2.560588, -2.525688, -2.484769, -2.433097, -2.363215, -2.328363, -2.325166
#*# 	-2.865975, -2.842894, -2.844144, -2.843857, -2.845592, -2.824368, -2.808571, -2.765486, -2.727622, -2.691363, -2.646839, -2.598825, -2.566006, -2.519980, -2.481919, -2.439808, -2.399447, -2.339820, -2.298102, -2.281923
#*# 	-2.822094, -2.824862, -2.823760, -2.833530, -2.816760, -2.803000, -2.789178, -2.737915, -2.700540, -2.649504, -2.591341, -2.550228, -2.505399, -2.465559, -2.411028, -2.379095, -2.351895, -2.293826, -2.276544, -2.276885
#*# 	-2.786204, -2.796733, -2.796732, -2.802363, -2.797933, -2.788541, -2.766191, -2.722500, -2.685942, -2.631124, -2.561850, -2.517151, -2.470158, -2.396239, -2.351289, -2.348078, -2.329017, -2.311844, -2.271540, -2.249713
#*# 	-2.754755, -2.762103, -2.773542, -2.774905, -2.779243, -2.773787, -2.752798, -2.720734, -2.681751, -2.607200, -2.526293, -2.446166, -2.399686, -2.338043, -2.312051, -2.301036, -2.295723, -2.272204, -2.257586, -2.282647
#*# 	-2.740812, -2.733812, -2.744964, -2.762252, -2.769598, -2.775579, -2.755778, -2.714725, -2.667722, -2.592697, -2.514736, -2.418985, -2.356257, -2.305287, -2.277285, -2.271042, -2.279919, -2.265230, -2.247487, -2.243223
#*# 	-2.721763, -2.733400, -2.748724, -2.768735, -2.771451, -2.771032, -2.750359, -2.706133, -2.651415, -2.573210, -2.488421, -2.385743, -2.343782, -2.283223, -2.249062, -2.255358, -2.256645, -2.243304, -2.241135, -2.250618
#*# 	-2.733163, -2.734770, -2.741771, -2.762467, -2.762995, -2.759321, -2.740619, -2.687689, -2.633063, -2.569102, -2.491925, -2.405330, -2.353250, -2.295206, -2.251958, -2.242016, -2.249735, -2.243708, -2.213382, -2.204048
#*# 	-2.724867, -2.737638, -2.755489, -2.763877, -2.756951, -2.744252, -2.723727, -2.680314, -2.622229, -2.560545, -2.497350, -2.428000, -2.364908, -2.304394, -2.275632, -2.252162, -2.236655, -2.219274, -2.207132, -2.205295
#*# 	-2.738792, -2.732927, -2.731319, -2.754352, -2.748207, -2.733833, -2.713592, -2.670933, -2.628051, -2.572958, -2.522843, -2.455251, -2.416229, -2.351470, -2.296303, -2.265333, -2.262009, -2.230997, -2.204738, -2.181574
#*# 	-2.721734, -2.720884, -2.730394, -2.731246, -2.729871, -2.709745, -2.702496, -2.654809, -2.620182, -2.572444, -2.524206, -2.479751, -2.435329, -2.380187, -2.340636, -2.301139, -2.266425, -2.239685, -2.214839, -2.230687
#*# 	-2.753795, -2.730725, -2.719286, -2.724678, -2.731677, -2.709485, -2.692483, -2.657190, -2.629195, -2.586105, -2.543230, -2.500169, -2.471570, -2.414203, -2.348867, -2.318243, -2.287400, -2.246844, -2.210928, -2.172536
#*# 	-2.775175, -2.760067, -2.742999, -2.735148, -2.728947, -2.707202, -2.689882, -2.664462, -2.635558, -2.601305, -2.556448, -2.519280, -2.500767, -2.448103, -2.388401, -2.335104, -2.290907, -2.249739, -2.223822, -2.215704
#*# 	-2.821722, -2.793944, -2.779374, -2.758420, -2.737352, -2.721371, -2.705160, -2.679419, -2.653013, -2.623596, -2.585371, -2.549810, -2.528667, -2.491346, -2.421790, -2.361033, -2.327356, -2.270458, -2.235056, -2.193514
#*# 	-2.844671, -2.830060, -2.811873, -2.786440, -2.765354, -2.729706, -2.722611, -2.690928, -2.671664, -2.639743, -2.602287, -2.570556, -2.550230, -2.503672, -2.456579, -2.400500, -2.345660, -2.294146, -2.260956, -2.257911
#*# 	-2.893848, -2.867267, -2.842557, -2.825070, -2.803886, -2.772324, -2.748661, -2.712825, -2.695820, -2.668056, -2.638803, -2.601534, -2.572695, -2.534468, -2.487054, -2.445963, -2.400200, -2.354669, -2.301160, -2.250526
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 234.83
#*# min_y = 20.0
#*# max_y = 244.96000000000004
